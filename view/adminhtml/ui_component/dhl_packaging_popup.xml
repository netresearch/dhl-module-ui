<?xml version="1.0" encoding="UTF-8"?>
<listing xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:module:Magento_Ui:etc/ui_configuration.xsd" component="Dhl_Ui/js/packaging/controller">
    <argument name="data" xsi:type="array">
        <item name="js_config" xsi:type="array">
            <item name="provider" xsi:type="string">dhl_packaging_popup.dhl_packaging_popup_data_source</item>
            <item name="deps" xsi:type="string">dhl_packaging_popup.dhl_packaging_popup_data_source</item>
        </item>
        <item name="spinner" xsi:type="string">dhl_packaging_popup_spinner</item>
    </argument>

    <dataSource name="dhl_packaging_popup_data_source">
        <argument name="dataProvider" xsi:type="configurableObject">
            <argument name="class" xsi:type="string">Dhl\Ui\DataProvider\PackagingPopup</argument>
            <argument name="name" xsi:type="string">dhl_packaging_popup_data_source</argument>
            <argument name="primaryFieldName" xsi:type="string">entity_id</argument>
            <argument name="requestFieldName" xsi:type="string">id</argument>
        </argument>
        <argument name="data" xsi:type="array">
            <item name="js_config" xsi:type="array">
                <item name="component" xsi:type="string">Magento_Ui/js/form/provider</item>
            </item>
        </argument>
    </dataSource>

    <fieldset name="dhl_fieldset_items" component="Dhl_Ui/js/packaging/view/fieldset">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="label" xsi:type="string" translate="true">Packing Items</item>
            </item>
        </argument>
        <settings>
            <dataScope>data.items</dataScope>
            <collapsible>true</collapsible>
            <opened>true</opened>
        </settings>
    </fieldset>

    <fieldset name="dhl_fieldset_item_properties" component="Dhl_Ui/js/packaging/view/fieldset">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="label" xsi:type="string" translate="true">Item Properties</item>
                <item name="js_config" xsi:type="array">
                    <item name="visible" xsi:type="boolean">false</item>
                </item>
            </item>
        </argument>
        <settings>
            <dataScope>data.item_properties</dataScope>
            <collapsible>true</collapsible>
            <opened>false</opened>
        </settings>
    </fieldset>

    <fieldset name="dhl_fieldset_package" component="Dhl_Ui/js/packaging/view/fieldset">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="label" xsi:type="string" translate="true">Package Details</item>
            </item>
        </argument>
        <settings>
            <dataScope>data.package</dataScope>
            <collapsible>true</collapsible>
            <opened>false</opened>
        </settings>
    </fieldset>

    <fieldset name="dhl_fieldset_package_customs" component="Dhl_Ui/js/packaging/view/fieldset">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="label" xsi:type="string" translate="true">Customs Information</item>
            </item>
        </argument>
        <settings>
            <dataScope>data.customs</dataScope>
            <collapsible>true</collapsible>
            <opened>false</opened>
        </settings>
    </fieldset>

    <fieldset name="dhl_fieldset_services" component="Dhl_Ui/js/packaging/view/fieldset">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="label" xsi:type="string" translate="true">Value-Added Features</item>
            </item>
        </argument>
        <settings>
            <dataScope>data.service</dataScope>
            <collapsible>true</collapsible>
            <opened>false</opened>
        </settings>
    </fieldset>

    <fieldset name="dhl_fieldset_summary" component="Dhl_Ui/js/packaging/view/fieldset">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="label" xsi:type="string" translate="true">Package Summary</item>
            </item>
        </argument>
        <settings>
            <dataScope>data.summary</dataScope>
            <collapsible>true</collapsible>
            <opened>false</opened>
        </settings>
        <button name="dhl_button_new_package">
            <argument name="data" xsi:type="array">
                <item name="config" xsi:type="array">
                    <item name="title" xsi:type="string" translate="true">Configure Another Package</item>
                    <item name="buttonClasses" xsi:type="string">action-default</item>
                    <item name="disabled" xsi:type="boolean">true</item>
                    <item name="actions" xsi:type="array">
                        <item name="0" xsi:type="array">
                            <item name="targetName" xsi:type="string">dhl_packaging_popup.dhl_packaging_popup</item>
                            <item name="actionName" xsi:type="string">reset</item>
                        </item>
                    </item>
                </item>
            </argument>
        </button>
        <button name="dhl_button_submit">
            <argument name="data" xsi:type="array">
                <item name="config" xsi:type="array">
                    <item name="title" xsi:type="string" translate="true">Create Shipment and Label</item>
                    <item name="buttonClasses" xsi:type="string">action-default submit-button primary</item>
                    <item name="actions" xsi:type="array">
                        <item name="0" xsi:type="array">
                            <item name="targetName" xsi:type="string">dhl_packaging_popup.dhl_packaging_popup</item>
                            <item name="actionName" xsi:type="string">submit</item>
                        </item>
                    </item>
                </item>
            </argument>
        </button>
    </fieldset>

    <!-- Templates that are used dynamically by the packaging popup. -->

    <!-- Button for fieldset navigation. Uses the setActiveFieldset method of the controller.
         Configure navigation target with nextFieldsetName property. -->
    <button name="dhl_button_next">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="isTemplate" xsi:type="boolean">true</item>
                <item name="title" xsi:type="string" translate="true">Next</item>
                <item name="buttonClasses" xsi:type="string">primary</item>
                <item name="actions" xsi:type="array">
                    <item name="0" xsi:type="array">
                        <item name="targetName" xsi:type="string">dhl_packaging_popup.dhl_packaging_popup</item>
                        <item name="actionName" xsi:type="string">setActiveFieldset</item>
                        <item name="params" xsi:type="array">
                            <item name="0" xsi:type="string">${ $.nextFieldsetName }</item>
                        </item>
                    </item>
                </item>
            </item>
        </argument>
    </button>
    <!-- Main packing items selection checkboc set. Receives options from runtime configuration. -->
    <component name="dhl_items_checkbox_set">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="isTemplate" xsi:type="boolean">true</item>
                <item name="component" xsi:type="string">Magento_Ui/js/form/element/checkbox-set</item>
                <item name="name" xsi:type="string">dhl_order_items</item>
                <item name="label" xsi:type="string" translate="true">Order Items</item>
                <item name="multiple" xsi:type="boolean">true</item>
                <item name="links" xsi:type="array">
                    <item name="value" xsi:type="string">${ $.provider }:data.selected_items</item>
                </item>
            </item>
        </argument>
    </component>
    <!-- Generic form input linked to an order item. Imports item Id from parent. -->
    <component name="dhl_item_field">
        <argument name="data" xsi:type="array">
            <item name="config" xsi:type="array">
                <item name="isTemplate" xsi:type="boolean">true</item>
                <item name="component" xsi:type="string">Magento_Ui/js/form/element/abstract</item>
                <item name="template" xsi:type="string">ui/form/field</item>
                <item name="links" xsi:type="array">
                    <!-- Remove default value link to datasource. Workaround. -->
                    <item name="value" xsi:type="string"/>
                </item>
                <item name="imports" xsi:type="array">
                    <item name="orderItemId" xsi:type="string">${ $.parent }:orderItemId</item>
                </item>
            </item>
        </argument>
    </component>
</listing>
